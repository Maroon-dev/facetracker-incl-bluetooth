<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>RawCam Web</title>
    <style>
        /* Reset & Basis */
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; overflow: hidden; font-family: -apple-system, sans-serif; }
        
        /* Video Container */
        #camera-view {
            width: 100%;
            height: 100%;
            object-fit: cover; /* Vult het hele scherm */
            display: block;
        }

        /* Sluiterknop */
        #shutter-btn {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            width: 70px;
            height: 70px;
            background-color: rgba(255,255,255,0.8);
            border: 4px solid #fff;
            border-radius: 50%;
            cursor: pointer;
            z-index: 10;
            transition: transform 0.1s;
        }
        #shutter-btn:active { transform: translateX(-50%) scale(0.95); background-color: #fff; }

        /* Feedback Flash */
        #flash {
            position: absolute; top:0; left:0; width:100%; height:100%;
            background: white; opacity: 0; pointer-events: none;
            transition: opacity 0.2s; z-index: 20;
        }

        /* Info tekst */
        #info {
            position: absolute; top: 20px; left: 0; width: 100%;
            text-align: center; color: rgba(255,255,255,0.5);
            font-size: 12px; pointer-events: none; z-index: 5;
        }
    </style>
</head>
<body>

    <video id="camera-view" autoplay playsinline muted></video>
    
    <canvas id="photo-canvas" style="display:none;"></canvas>

    <div id="info">Zoekst naar maximale resolutie...</div>
    <div id="shutter-btn"></div>
    <div id="flash"></div>

    <script>
        const video = document.getElementById('camera-view');
        const canvas = document.getElementById('photo-canvas');
        const shutterBtn = document.getElementById('shutter-btn');
        const flash = document.getElementById('flash');
        const info = document.getElementById('info');

        // Camera Instellingen
        const constraints = {
            audio: false,
            video: {
                facingMode: { exact: "environment" }, // Achtercamera
                width: { ideal: 4096 }, // Probeer 4K te pakken
                height: { ideal: 2160 }
            }
        };

        async function startCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia(constraints);
                video.srcObject = stream;
                
                // Wacht tot de video metadata geladen is om de werkelijke resolutie te tonen
                video.onloadedmetadata = () => {
                    const track = stream.getVideoTracks()[0];
                    const settings = track.getSettings();
                    info.textContent = `Stream: ${settings.width}x${settings.height}px (Web "Raw")`;
                };
            } catch (err) {
                // Fallback als 'environment' niet werkt (bijv. desktop)
                try {
                    const fallbackStream = await navigator.mediaDevices.getUserMedia({ video: true });
                    video.srcObject = fallbackStream;
                    info.textContent = "Fallback camera modus";
                } catch (e) {
                    alert("Geen toegang tot camera. Controleer instellingen.");
                }
            }
        }

        function takePhoto() {
            // Flash effect
            flash.style.opacity = 1;
            setTimeout(() => flash.style.opacity = 0, 100);

            // Canvas instellen op exacte video grootte
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            
            const ctx = canvas.getContext('2d');
            // Teken het huidige video frame op het canvas
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

            // Exporteer als PNG (Lossless compressie, geen JPEG compressie)
            canvas.toBlob((blob) => {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = url;
                // Bestandsnaam met timestamp
                const date = new Date();
                a.download = `IMG_${date.getTime()}.png`;
                document.body.appendChild(a);
                a.click();
                
                // Opruimen
                setTimeout(() => {
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);
                }, 100);
            }, 'image/png');
        }

        shutterBtn.addEventListener('click', takePhoto);
        
        // Start de app
        startCamera();
    </script>
</body>
</html>
